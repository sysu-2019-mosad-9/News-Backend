os: linux
language: rust
services: docker
rust:
  - nightly-2019-11-13
cache: cargo

before_script:
  - rustup component add rustfmt
  - rustup component add clippy
script:
  - cargo fmt --all -- --check
  - cargo check --all --all-targets
  - cargo clippy --all --all-targets

before_deploy:
  - docker build -t dasinlsb/newsback:lts .
  - echo "$DOCKER_PASSWORD" | docker login -u $DOCKER_USERNAME --password-stdin
  - docker push dasinlsb/newsback:lts

deploy:
  provider: script
  script: bash ci/deploy.sh
  on:
    branch: master
